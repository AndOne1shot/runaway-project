<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.ProjectDAO">

	<!-- sns게시판 갯수 불러오기 -->
	<select id="getTotal" parameterType="sns" resultType="int">
		select count(*) from sns
		<where>
			<if test="keyword != null and search !='subcon'">
				${search} like '%'||#{keyword}||'%'
			</if>
			<if test="keyword != null and search=='subcon'">
				sns_subject like '%'||#{keyword}||'%' or
				sns_content like '%'||#{keyword}||'%'
			</if>
		</where>
	</select>
	
	<!-- 페이지 처리에 의한 sns게시판 데이터리스트 불러오기 -->
	<select id="list" parameterType="sns" resultType="sns">
		select * from (select a.*,rowNum rn from (
			select * from sns
		<where>
			<if test="keyword != null and search!='subcon'">
				${search} like '%'||#{keyword}||'%'
			</if>
			<if test="keyword != null and search=='subcon'">
				sns_subject like '%'||#{keyword}||'%' or
				sns_content like '%'||#{keyword}||'%'
			</if>
		</where>			
			 order by sns_no desc) a )
			where rn between #{startRow} and #{endRow}
	</select>
	
	<!-- 회원가입을 위한 sql -->
	<insert id="insert" parameterType="runner">
		insert into runner values(#{user_id},#{user_passwd},#{user_name},
								  #{user_nickname},#{user_jumin1},#{user_jumin2},
								  #{user_emailid},#{user_domain},#{user_phone1},
								  #{user_phone2},#{user_phone3},#{user_address1},
								  #{user_address2},#{user_photo},0,0,#{user_gender},sysdate)
	</insert>
	
	<!-- 세션값 설정을 위한 membetDTO생성 -->
	<select id="getMember" parameterType="String" resultType="runner">
		select * from runner where user_id=#{user_id}
	</select>
	
	<!-- id확인 -->
	<select id="idcheck" parameterType="String" resultType="int">
		select count(*) from runner where user_id=#{user_id}
	</select>
	<!-- 닉네임확인 -->
	<select id="nicknamecheck" parameterType="String" resultType="int">
		select count(*) from runner where user_nickname=#{user_nickname}
	</select>
	
	<!-- sns게시판 목록 가져오기 -->
	<select id="getboard" parameterType="int" resultType="sns">
		select * from sns where sns_no=#{sns_no}
	</select>
	
	<!-- runner_date에서 특정 runner_date_no에 따라서 리스트 가져오기  -->
	<select id="getrdata" parameterType="int" resultType="runner_data">
		select * from runner_data where runner_data_no=#{runner_data_no}
	</select>
	
	<!-- coordinate에서 특정 runner_date_no에 따라서 리스트 가져오기  -->
	<select id="getcdata" parameterType="int" resultType="coordinate">
		select * from coordinate where runner_data_no=#{runner_data_no}
	</select>
	<!-- runner_data에서 특정 id의 리스트 갯수 가져오기 -->
	<select id="getTotalfromrd" parameterType="String" resultType="int">
		select count(*) from runner_data where user_id = #{user_id}
	</select>
	<!-- runner_data에서 특정 id의 리스트 가져오기 -->
	<select id="listfromrd" parameterType="runner_data" resultType="runner_data">
		select * 
		from (select a.*,rowNum rn 
			  from ( select * 
			  		 from runner_data 
			  		 order by runner_data_date desc) a )
			where rn between #{startRow} and #{endRow}
	</select>
	<!-- 아이디 찾기 -->
	<select id="findid" parameterType="runner" resultType="runner">

		select * from runner where user_jumin1 = #{user_jumin1} and user_jumin2 =
		#{user_jumin2}

	</select>
	
	<!-- 비번 찾기 -->
	<select id="findpass" parameterType="runner" resultType="runner">

		select * from runner where  user_id = #{user_id}   and  user_jumin1 = #{user_jumin1} and user_jumin2 = #{user_jumin2}

	</select>
</mapper>