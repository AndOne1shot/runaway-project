<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.MateReplyDAO">

	<!-- Use type aliases to avoid typing the full classname every time. -->
	<resultMap id="rbResult"          type="rb">
		<result property="recruit_r_no"	      column="recruit_r_no" />
		<result property="recruit_no"    	  column="recruit_no" />
		<result property="user_id"  		  column="user_id" />
		<result property="recruit_r_step"     column="recruit_r_step" />
		<result property="recruit_r_level"    column="recruit_r_level" />
		<result property="recruit_r_content"  column="recruit_r_content" />
		<result property="recruit_r_date" 	  column="recruit_r_date" />
		<result property="recruit_r_count" 	  column="recruit_r_count" />
		<result property="recruit_r_del" 	  column="recruit_r_del" />
	</resultMap>
	
	<select id="list" parameterType="int" resultMap="rbResult">
<!-- 		select * from recruit_r where recruit_no=#{num} order by recruit_r_no -->
<!-- 			select * from (select a.*,rowNum rn from ( -->
<!-- 				select * from recruit_r	where recruit_no=#{recruit_no}			 -->
<!-- 				order by recruit_r_count, recruit_r_step) a ) -->
				
			select * from (select a.*,rowNum rn from (
			select * from recruit_r				
			 order by recruit_r_count, recruit_r_step) a ) where recruit_no = #{recruit_no}
			
	</select>
	
	
	<select id="select" parameterType="int" resultType="rb">
		select * from recruit_r where recruit_r_no=#{rno}
	</select>
	
	
	
	<insert id="insert" parameterType="rb" >
<!-- 		<selectKey keyProperty="recruit_r_no" order="BEFORE" resultType="int"> -->
<!-- 			select nvl(max(recruit_r_no),0) + 1 from recruit_r -->
<!-- 		</selectKey> -->
			insert into recruit_r values (
			recruit_r_no_seq.nextval,
			#{recruit_no},
			#{user_id},
			#{recruit_r_step},
			#{recruit_r_level},
			#{recruit_r_content},
			sysdate,
			#{recruit_r_count},
			#{recruit_r_del}
			)
	</insert>
	
	
	
	<update id="update" parameterType="rb">
		update recruit_r set recruit_r_content=#{recruit_r_content},
			recruit_r_date=sysdate where recruit_r_no=#{recruit_r_no} 
	</update>
	
	<delete id="delete" parameterType="int">
		delete from recruit_r where recruit_r_no=#{recruit_r_no}
	</delete>
	
	<select id="getMaxNum" resultType="int">
		select nvl((count(*)),0)+1 from recruit_r
	</select>

	<select id="getMaxNum2" resultType="int">
		select nvl(max(recruit_r_step), 0)+1 from recruit_r where recruit_r_del= #{recruit_r_no} 
	</select>
	
<!-- 	<select id="getMaxNum2" resultType="int"> -->
<!-- 		select count(recruit_r_step)+1 from recruit_r where recruit_r_del= #{recruit_r_no}  -->
<!-- 	</select> -->
	
	
	
	
	<update id="updateRe" parameterType="rb">
		update recruit_r set recruit_r_step = recruit_r_step + 1
			where recruit_r_del=#{recruit_r_no} and recruit_r_step > #{recruit_r_step}
		
	</update>
	
	<update id="update2" parameterType="rb">
		update recruit_r set recruit_r_step = recruit_r_step + 1 where recruit_r_
	</update>
	
	<select id="getChild" parameterType="int">
<!-- 		select nvl(max(recruit_r_step),0) from recruit_r where recruit_r_del = #{recruit_r_no} -->
		    select nvl(min(recruit_r_step),0) from recruit_r where recruit_r_step > #{recruit_r_step} 
		    	and recruit_r_level &lt;= #{recruit_r_level} and recruit_r_count = #{recruit_r_count} order by recruit_r_step
		
	</select>	
	
	
	
	
	<update id="updateStep" parameterType="rb">
		update recruit_r set recruit_r_step = recruit_r_step + 1 
			where recruit_r_count=#{recruit_r_count} and recruit_r_step >= #{recruit_r_step}
	
	</update>
	
	
	<select id="rgetdetail" parameterType="int" resultType="recruit">
		select * from recruit where recruit_no=#{no}
	</select>
	
	
	
	
</mapper>